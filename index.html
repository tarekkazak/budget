<!DOCTYPE html>
<html lang="en" ng-app="budgetApp">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0;">
    <title>Budget</title>
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/bootstrap-theme.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script type="text/javascript" src="js/jQuery.js" ></script>
    <script type="text/javascript" src="js/bootstrap.min.js" ></script>
    <script type="text/javascript" src="js/angular_1.2.9.js" ></script>
    <script type="text/javascript" src="js/angular-sanitize.js"></script>
    <script type="text/javascript" src="js/spin-min.js"></script>
    <script type="text/javascript" src="js/angular-spinner.min.js"></script>
    <script type="text/javascript" src="js/angular-route.min.js" ></script>
    <script type="text/javascript" src="js/ui-bootstrap-tpls-0.10.0.min.js" ></script>
    <script type="text/javascript" src="js/underscore-min.js" ></script>
    <script type="application/javascript" src="app/app.js" ></script>


</head>
<body ng-controller="controller">


    <div class="container">


            <div class="row">
                <div class="col-sm-6 col-md-6">
                    <div class="dropdown" >
                        <button class="btn dropdown-toggle" >
                            {{selectedMonth || "Select a month"}}
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-repeat="n in [1,2,3,4,5,6,7,8,9,10,11,12]"><a ng-click="updateSelectedMonth(n)">{{n}}</a></li>
                        </ul>
                    </div>

                    <div class="dropdown" >
                        <button class="btn dropdown-toggle" >
                            {{selectedYear || "Select a year"}}
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-repeat="n in [2014,2015,2016,2017]"><a ng-click="updateSelectedYear(n)">{{n}}</a></li>
                        </ul>
                    </div>

                    <div>
                        <button class="btn btn-primary" ng-show="!inEditMode && expenses.length > 0" ng-model="inEditMode" ng-click="startEditMode()">Edit</button>
                        <div ng-show="inEditMode">
                            <input type="text" ng-model="newCategoryName" placeholder="enter new category name">
                            <button class="btn btn-default" ng-click="addCategory()">Add category</button>

                            <div class="dropdown" >
                                <button class="btn dropdown-toggle" >
                                    {{selectedExpense.label || "Select category"}}
                                </button>
                                <ul class="dropdown-menu">
                                    <li ng-repeat="expense in expenses" ng-if="expense.hasOwnProperty('children')">
                                        <a ng-click="selectExpense(expense)" >{{expense.label}}</a>
                                    </li>

                                </ul>
                            </div>

                            <input type="text" ng-model="newFieldName" placeholder="enter new field name">
                            <input type="text" ng-model="newFieldAmt" placeholder="enter new field amount">
                            <button class="btn btn-primary" ng-click="addField()">Add field</button>
                            <button class="btn btn-primary" ng-click="save(); inEditMode = false">Save</button>
                            <div>
                                <label for="update-template">Save to template</label>
                                <input id="update-template" type="checkbox" class="checkbox" ng-model="updateTemplate" >
                            </div>

                            <button class="btn btn-default" ng-click="cancelEditMode()">Cancel</button>
                        </div>
                    </div>

                    <table ng-class="{'hidden' : expenses.length == 0, 'visible' : expenses.length > 0}" class="table table-bordered">
                        <tbody ng-repeat="expense in expenses">
                        <tr  >
                            <td>{{expense.label}}</td>
                            <td >
                                <div class="controls">
                                  <input ng-if="!expense.hasOwnProperty('children')" ng-change="updateExpenseAmount(expense, expense.amt)" ng-model="expense.amt"  ng-class="{'bold-red' : expense.amt < 0}" type="text"  >
                                    <button ng-if="!expense.hasOwnProperty('children')" class="btn btn-danger" ng-show="inEditMode" ng-click="removeExpense(expense, null)">
                                        remove
                                    </button>
                                </div>
                            </td>
                            <td>{{expense.remainder || expense.amt}}</td>
                        <tr ng-repeat="sub in expense.children"  ng-if="expense.hasOwnProperty('children')">
                                <td>
                                    <span style="padding-left: 30px">{{sub.label}}</span>
                                </td>
                                <td >
                                    <div class="controls">
                                        <input ng-change="updateExpenseAmount(sub, sub.amt)" ng-model="sub.amt"  ng-class="{'bold-red' : sub.amt < 0}" type="text"  >
                                        <button class="btn btn-danger" ng-show="inEditMode" ng-click="removeExpense(sub, expense)">
                                            remove
                                        </button>
                                    </div>

                                </td>
                                <td>{{sub.remainder || sub.amt}}</td>
                            </tr>
                        </tr>



                        </tbody>
                        <tbody>
                            <tr>
                                <td>Total</td>
                                <td>{{getTotalExpenses()}}</td>
                            </tr>
                        </tbody>
                     </table>
                </div>

                <div class="col-sm-6 col-md-6">
                    <form class="form-horizontal" name="form">
                    <div class="control-group">


                        <div class="dropdown" >
                            <button class="btn dropdown-toggle" >
                                {{selectedExpense.label || "Select"}}
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat-start="expense in expenses" ng-if="expense.hasOwnProperty('children') && !expenses[$index - 1].hasOwnProperty('children')" class="divider"></li>
                                <li   ng-class="{'dropdown-header' : expense.hasOwnProperty('children')}">
                                    {{expense.hasOwnProperty('children') ? expense.label : ""}}
                                    <a ng-click="selectExpense(expense)" ng-if="!expense.hasOwnProperty('children')">{{expense.label}}</a>
                                  </li>
                                <li ng-repeat="item in expense.children">
                                    <a ng-click="selectExpense(item)">{{item.label}}</a>
                                </li>
                                <li ng-if="expense.hasOwnProperty('children')" ng-repeat-end class="divider"></li>
                            </ul>
                        </div>


                        <div class="controls">
                            <input type="text" ng-model="amount"  name="amount" placeholder="Amount">
                        </div>

                        <div class="controls">
                            <input type="text" ng-model="totalFunds" placeholder="Total funds">
                        </div>

                        <div class="controls">
                            {{totalFunds - getTotalExpenses()}}
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="controls">

                            <button class="btn btn-default" ng-click="applyPaymentToExpense(amount)" type="submit" class="btn">Apply</button>
                            <button class="btn btn-default" ng-click="zeroOutExpense()" class="btn">Empty</button>
                            <button class="btn btn-primary" ng-click="save()" class="btn">Save</button>
                        </div>
                    </div>
                </form>
                </div>
            </div>


    </div>
</body>
</html>